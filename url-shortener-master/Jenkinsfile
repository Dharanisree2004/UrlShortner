pipeline {
    agent any

    // environment {
    //     // Example DB config (make sure Jenkins has access or you use a test profile)
    //     SPRING_DATASOURCE_URL = 'jdbc:mysql://localhost:3306/urlshortenerdb'
    //     SPRING_DATASOURCE_USERNAME = 'root'
    //     SPRING_DATASOURCE_PASSWORD = 'Dharani@2004'
    // }

    stages {

        stage('Checkout Code') {
            steps {
                git branch: 'main', url: 'https://github.com/Dharanisree2004/UrlShortner.git'
            }
        }

        stage('Build with Maven') {
            steps {
                sh 'mvn clean package -DskipTests'
            }
        }

        stage('Run Tests') {
            steps {
                sh 'mvn test'
            }
        }

        stage('Deploy') {
            steps {
                echo "Deployment step (manual or script-based) can go here."
                echo "Generated JAR: target/url-shortener-0.0.1-SNAPSHOT.jar"
                // e.g., copy to a server with scp or run java -jar directly
            }
        }
    }

    post {
        success {
            echo "Build & test completed successfully."
        }
        failure {
            echo "Build failed."
        }
    }
}
